# MES制造执行系统概览

## 系统概述

MES（制造执行系统）是一个完整的制造业数字化解决方案，基于MES系统全局架构基础文档设计，包含BI数据大屏、MES后台管理系统、供应商端移动端等完整功能模块。系统支持从原材料入库到成品出货的全流程数字化管理，实现生产过程的透明化、可追溯化和智能化。

## 系统架构

### 1. 总功能模块

#### 1.1 BI 数据大屏看板
- **功能**：数据追踪、报表展示与生产状态可视化
- **技术栈**：Vue3 + ECharts + Element Plus
- **特性**：
  - 实时生产监控（≤2分钟延迟）
  - 良率趋势分析
  - WIP状态分布
  - 设备效率监控
  - 告警信息展示

#### 1.2 MES 后台管理系统（核心系统）
- **功能**：资产管理、流程追踪、品质管控、物流管理等核心模块
- **技术栈**：Vue3 + Element Plus + REST API
- **核心模块**：
  - **资产管理**：模具/辅料/主料台账管理
  - **品质管理**：IQC、IPQC、OQC、返修、测试、NCR/SCAR
  - **物流管理**：入库/出库/盘点/备料/库存对账
  - **生产管理**：工单、SOP、工艺路线、首件/批次生产
  - **追溯管理**：正向/反向全链路追溯

#### 1.3 供应商端移动端/小程序
- **功能**：支持多用户登录与多设备登录，负责模具状态、发货及质检协同
- **技术栈**：uniapp + uview-plus
- **特性**：
  - 模具状态监控
  - 发货订单管理
  - IQC检验协同
  - 库存查询
  - 消息通知

### 2. 核心业务流程

#### 2.1 新项目流程
- 与总部（ITL）沟通试产方案
- 完成FAI（首件验证）
- 批量生产

#### 2.2 旧项目流程
- 区分总部订单与三方订单
- 经首件验证后批量生产

#### 2.3 完整生产流程
```
海关报备与原料入库（物流域）→ 
IQC 进料检验（品质域）→ 
试产/首件（生产域）→ 
批量生产 + IPQC 抽检 → 
测试、维修、OQC 抽检与出货 → 
年度盘点与 ERP 数据比对
```

## 技术架构

### 1. 系统分层

#### 1.1 前端层
- **MES Web**：Vue3 + Element Plus
- **BI 大屏**：Vue3 + ECharts
- **移动端**：uniapp 或小程序原生

#### 1.2 业务服务层（REST API）
- **资产管理**：模具/辅料/主料台账
- **品质管理**：IQC、IPQC、OQC、返修、测试、NCR/SCAR
- **物流管理**：入库/出库/盘点/备料/库存对账
- **生产管理**：工单、SOP、工艺路线、首件/批次生产
- **追溯管理**：正向/反向全链路追溯

#### 1.3 数据层
- **事务库**：MySQL 8.0+
- **缓存**：Redis（缓存与锁）
- **文件存储**：OSS（影像与附件）

### 2. 系统集成

#### 2.1 外部系统集成
- **ERP**：对接BOM、工单、库存同步
- **ITL 总部**：新项目FAI报告、ECN文件上传
- **供应商系统**：订单发货与IQC状态同步

#### 2.2 数据集成
- **实时数据**：WebSocket推送
- **批量数据**：定时同步
- **文件数据**：OSS存储

## 核心特性

### 1. 完整的追溯体系

#### 1.1 正向追溯
```
订单 → 工单 → 批次/序列号 → 测试/维修 → OQC → 出货
```

#### 1.2 反向追溯
```
序列号 → 批次 → 原料批次/供应商 → 模具 → IQC → 工序/责任人
```

#### 1.3 事件溯源
- 所有可追节点抽象为不可变事件
- 支持完整的生产链路追踪
- 基于`trace_event`表的事件驱动架构

### 2. 品质管理

#### 2.1 IQC流程数字化
- 电子SOP + AQL自动抽样
- 影像直传OSS
- 不合格触发NCR/SCAR并计入供应商评分

#### 2.2 FAI首件控制
- 未通过禁止批量投产
- 生成首件合格报告归档

#### 2.3 生产与巡检
- WIP状态机：待投产→装配→初测→返修→复测→终测→打包
- IPQC抽检频次随不合格率动态调整

#### 2.4 OQC与盘点
- 按客户协议配置AQL
- 移动端扫码盘点与差异审计

### 3. BI近实时体系

#### 3.1 目标
在不引入大数据栈前提下，仅用MySQL + Redis实现分钟级伪实时渲染

#### 3.2 SLA
- **生产域**：≤2分钟
- **品质域**：≤3分钟
- **物流域**：≤5分钟

#### 3.3 技术方案
- 只读副本查询
- 增量物化表（1–5分钟）
- binlog位点或`updated_at > last_ts`拉增量
- Redis终端指标缓存（TTL 30–120s）
- WebSocket推送
- 聚合作业幂等与回看窗口（10–15分钟）

### 4. 数据标识体系

| 对象   | 标识规则               | 说明                        |
| ------ | ---------------------- | --------------------------- |
| 物料   | ITM-YYYYMM-XXXX        | 与ERP `item_code`唯一映射   |
| 模具   | MLD-SUP-XXXX           | SUP为供应商编码             |
| 供应商 | SUP-XXXXX              | 供应商主数据                |
| 采购订单 | PO-YYYYMMDD-SEQ        | 对应ERP `po_no`             |
| 收货/来料 | GRN-YYYYMMDD-SEQ     | 收货批                      |
| 生产工单 | WO-LINE-SEQ            | 产线LINE                    |
| 生产批次 | LOT-YYYYMMDD-SEQ       | 与工单强关联                |
| 序列号 | SN-{lot_id}-{SEQ}      | 强绑定批次                  |
| 箱号   | BOX-YYYYMMDD-SEQ       | 出货包装                    |
| 托盘号 | PLT-YYYYMMDD-SEQ       | 物流打托                    |
| 出货单 | SHP-YYYYMMDD-SEQ       | 出货主单                    |
| 检验单 | INSP-{type}-YYYYMMDD-SEQ | type=IQC/IPQC/OQC/FAI    |
| NCR/SCAR | NCR-.../SCAR-...     | 闭环质量                    |

## 数据库架构

### 1. 核心数据库表（30个）

#### 1.1 基础数据表（3个）
- `item_master` - 物料主数据
- `supplier_master` - 供应商主数据
- `mold_master` - 模具主数据

#### 1.2 采购与收货管理（4个）
- `purchase_order` - 采购订单
- `purchase_order_item` - 采购订单明细
- `goods_receipt_note` - 收货单
- `goods_receipt_item` - 收货明细

#### 1.3 生产管理（3个）
- `work_order` - 生产工单
- `production_lot` - 生产批次
- `serial_number` - 序列号

#### 1.4 工艺路线与工序管理（2个）
- `routing` - 工艺路线
- `operation` - 工序定义

#### 1.5 品质管理（3个）
- `inspection` - 检验单
- `inspection_item` - 检验明细
- `test_record` - 测试记录

#### 1.6 库存管理（2个）
- `stock` - 库存
- `stock_transaction` - 库存事务

#### 1.7 追溯系统核心表（3个）
- `trace_event` - 追溯事件
- `map_sn` - 序列号映射
- `map_lot_material` - 批次用料映射

#### 1.8 系统配置与字典表（2个）
- `qms_code` - 品质代码
- `attachment` - 附件

#### 1.9 BI数据聚合表（8个）
- `agg_yield_5m` - 良率聚合
- `agg_wip_status` - WIP状态聚合
- `agg_production_progress` - 生产进度聚合
- `agg_equipment_efficiency` - 设备效率聚合
- `agg_quality_stats` - 品质统计聚合
- `agg_inventory_turnover` - 库存周转聚合
- `agg_supplier_performance` - 供应商绩效聚合
- `agg_cost_analysis` - 成本分析聚合
- `agg_alert_stats` - 告警统计聚合

### 2. 数据库特性

#### 2.1 多租户支持
- `tenant_id` / `site_id` 字段
- 数据隔离和权限控制

#### 2.2 审计跟踪
- `created_by/created_at/updated_by/updated_at/source_system`
- 完整的操作历史记录

#### 2.3 版本控制
- `version/effective_from/effective_to`
- 支持数据版本管理

## 非功能性要求

### 1. 性能要求
- **大表分区**：按日/周分区
- **热点数据缓存**：Redis缓存
- **统计查询**：走只读副本
- **响应时间**：API响应时间<500ms

### 2. 安全要求
- **身份认证**：JWT + 刷新令牌
- **文件安全**：附件预签名URL
- **数据权限**：行级数据权限
- **传输安全**：HTTPS加密

### 3. 可靠性要求
- **幂等性**：分布式锁控制
- **数据备份**：主从复制与定时备份
- **故障恢复**：自动故障转移
- **数据一致性**：ACID事务保证

### 4. 可维护性要求
- **链路追踪**：TraceID贯穿
- **操作审计**：完整的操作日志
- **监控告警**：实时监控和告警
- **文档完整**：完整的API和系统文档

## 部署架构

### 1. 开发环境
- 本地数据库实例（MySQL 8.0+）
- 本地Redis实例
- 开发工具链（Vue3、Node.js等）

### 2. 测试环境
- 模拟生产环境配置
- 自动化测试
- 性能基准测试

### 3. 生产环境
- 高可用配置（主从复制）
- 负载均衡
- 监控和告警
- 备份和恢复

## 版本策略

### 当前版本：v1.0
- **状态**：完整MES系统架构
- **范围**：BI大屏、MES后台、移动端、完整数据库架构
- **稳定性**：生产就绪

### 版本命名规范
- **主版本**：重大架构变更或不兼容变更
- **次版本**：新功能添加，向后兼容
- **修订版本**：Bug修复和小幅改进

## 后续规划

### v1.1 计划
- 完善API接口开发
- 添加更多BI图表
- 优化移动端用户体验

### v1.2 计划
- 集成更多外部系统
- 添加AI智能分析
- 实施高级排产算法

### v1.3 计划
- 微服务架构改造
- 容器化部署
- 云原生架构

## 相关资源

- [标准与规范](01-standards-and-conventions.md)
- [领域词汇表](02-domain-glossary.md)
- [逻辑模型](03-logical-model.md)
- [物理布局](04-physical-layout.md)
- [架构决策记录](../decisions/ADR-0001.md)
- [MES系统全局架构基础文档](../MES系统全局架构基础文档.md)