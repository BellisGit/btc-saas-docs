# BTC-SaaS MESç³»ç»Ÿ æ•°æ®åº“è¡¨ç»“æ„æ¸…å•

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æ•´ç†äº†BTC-SaaS MESç³»ç»Ÿä¸­æ‰€æœ‰æ•°æ®åº“è¡¨çš„å®Œæ•´æ¸…å•ï¼ŒæŒ‰æ•°æ®åº“å’ŒåŠŸèƒ½æ¨¡å—åˆ†ç±»ï¼Œæ–¹ä¾¿è¿›è¡Œè¡¨ç»“æ„çš„å¢åˆ æ“ä½œã€‚

**ç»Ÿè®¡ä¿¡æ¯ï¼š**
- æ€»æ•°æ®åº“æ•°é‡ï¼š**5ä¸ª**
- æ€»è¡¨æ•°é‡ï¼š**çº¦132å¼ è¡¨**
- æ ¸å¿ƒä¸šåŠ¡è¡¨ï¼š**45å¼ **
- BIèšåˆè¡¨ï¼š**47å¼ **
- æ—¥å¿—è¡¨ï¼š**25å¼ **
- ç³»ç»Ÿç®¡ç†è¡¨ï¼š**15å¼ **

---

## ğŸ—„ï¸ æ•°æ®åº“æ¶æ„

### 1. **btc_core** - æ ¸å¿ƒæ•°æ®åº“ (45å¼ è¡¨)
å­˜å‚¨æ‰€æœ‰æ ¸å¿ƒä¸šåŠ¡æ•°æ®ï¼Œæ”¯æŒå¤æ‚äº‹åŠ¡å’Œå¼ºä¸€è‡´æ€§è¦æ±‚ã€‚

### 2. **btc_procurement** - é‡‡è´­ç®¡ç†æ•°æ®åº“ (9å¼ è¡¨)
å­˜å‚¨é‡‡è´­ç›¸å…³çš„ä¸šåŠ¡æ•°æ®ï¼Œç‹¬ç«‹æ‰©å±•ã€‚

### 3. **btc_maintenance** - ç»´ä¿®ç®¡ç†æ•°æ®åº“ (10å¼ è¡¨)
å­˜å‚¨ç»´ä¿®ç›¸å…³çš„ä¸šåŠ¡æ•°æ®ï¼Œç‹¬ç«‹æ‰©å±•ã€‚

### 4. **btc_log** - æ—¥å¿—æ•°æ®åº“ (15å¼ è¡¨)
å­˜å‚¨æ‰€æœ‰æ“ä½œæ—¥å¿—ã€ç³»ç»Ÿæ—¥å¿—ã€å®¡è®¡æ—¥å¿—ã€‚

### 5. **btc_bi** - BIåˆ†ææ•°æ®åº“ (47å¼ è¡¨)
å­˜å‚¨BIèšåˆæ•°æ®ã€å®æ—¶æŒ‡æ ‡ã€æŠ¥è¡¨æ•°æ®ã€å¼‚å¸¸é¢„è­¦ç›‘æ§ã€‚

---

## ğŸ“Š è¯¦ç»†è¡¨ç»“æ„æ¸…å•

## ğŸ—ï¸ btc_core æ•°æ®åº“ (45å¼ è¡¨)

### 1.1 ç³»ç»ŸåŸºç¡€è¡¨ (9å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `tenant` | ç§Ÿæˆ·ç®¡ç†è¡¨ | å¤šç§Ÿæˆ·ç®¡ç† | tenant_id, tenant_code, tenant_name |
| `sys_dept` | éƒ¨é—¨è¡¨ | éƒ¨é—¨ç»„ç»‡æ¶æ„ | dept_id, dept_code, dept_name, parent_id |
| `sys_user` | ç”¨æˆ·è¡¨ | ç³»ç»Ÿç”¨æˆ·ç®¡ç† | user_id, username, email, phone, dept_id |
| `sys_role` | è§’è‰²è¡¨ | è§’è‰²å®šä¹‰ï¼ˆæ”¯æŒç»§æ‰¿ï¼‰ | role_id, role_name, parent_role_id, role_level |
| `sys_permission` | æƒé™è¡¨ | æƒé™å®šä¹‰ | permission_id, permission_code, permission_type |
| `sys_menu` | èœå•è¡¨ | ç³»ç»Ÿèœå• | menu_id, menu_name, menu_url, path |
| `sys_menu_permission` | èœå•æƒé™å…³è” | èœå•æƒé™å…³è” | menu_id, permission_id |
| `sys_user_role` | ç”¨æˆ·è§’è‰²å…³è” | ç”¨æˆ·è§’è‰²åˆ†é… | user_id, role_id |
| `sys_role_permission` | è§’è‰²æƒé™å…³è” | è§’è‰²æƒé™åˆ†é… | role_id, permission_id |

### 1.2 ä¸»æ•°æ®ç®¡ç†è¡¨ (6å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `item_master` | ç‰©æ–™ä¸»æ•°æ® | ç‰©æ–™åŸºç¡€ä¿¡æ¯ | item_id, item_code, item_name |
| `supplier_master` | ä¾›åº”å•†ä¸»æ•°æ® | ä¾›åº”å•†ä¿¡æ¯ | supplier_id, supplier_code, supplier_name |
| `customer_master` | å®¢æˆ·ä¸»æ•°æ® | å®¢æˆ·ä¿¡æ¯ | customer_id, customer_code, customer_name |
| `location_master` | åº“ä½ä¸»æ•°æ® | ä»“åº“ä½ç½® | location_id, location_code, location_name |
| `defect_code_master` | ç¼ºé™·ä»£ç  | è´¨é‡ç¼ºé™·å®šä¹‰ | defect_code, defect_name, severity |
| `cause_code_master` | åŸå› ä»£ç  | ç¼ºé™·åŸå› å®šä¹‰ | cause_code, cause_name, category |

### 1.3 å·¥å‚é…ç½®è¡¨ (6å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `plant` | å·¥å‚è¡¨ | å·¥å‚åŸºç¡€ä¿¡æ¯ | plant_id, plant_code, plant_name |
| `production_line` | äº§çº¿è¡¨ | ç”Ÿäº§çº¿ä¿¡æ¯ | line_id, line_code, line_name |
| `workstation` | å·¥ä½è¡¨ | å·¥ä½ä¿¡æ¯ | station_id, station_code, station_name |
| `equipment` | è®¾å¤‡è¡¨ | è®¾å¤‡ä¿¡æ¯ | equipment_id, equipment_code, equipment_name |
| `sensor` | ä¼ æ„Ÿå™¨è¡¨ | ä¼ æ„Ÿå™¨é…ç½® | sensor_id, sensor_code, sensor_type |
| `skill` | æŠ€èƒ½è¡¨ | å‘˜å·¥æŠ€èƒ½å®šä¹‰ | skill_id, skill_code, skill_name |

### 1.4 ç”Ÿäº§ç®¡ç†è¡¨ (6å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `work_order` | å·¥å•è¡¨ | ç”Ÿäº§å·¥å• | wo_id, wo_no, item_id, planned_qty |
| `routing` | å·¥è‰ºè·¯çº¿ | å·¥è‰ºè·¯çº¿å®šä¹‰ | routing_id, routing_code, item_id |
| `routing_operation` | å·¥è‰ºå·¥åº | å·¥è‰ºå·¥åºå®šä¹‰ | operation_id, routing_id, operation_seq |
| `bom_header` | BOMè¡¨å¤´ | ç‰©æ–™æ¸…å•è¡¨å¤´ | bom_id, item_id, version |
| `bom_detail` | BOMæ˜ç»† | ç‰©æ–™æ¸…å•æ˜ç»† | bom_id, component_id, qty |
| `wo_operation` | å·¥å•å·¥åº | å·¥å•å·¥åºæ‰§è¡Œ | wo_id, operation_id, status |

### 1.5 è´¨é‡ç®¡ç†è¡¨ (4å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `inspection_plan` | æ£€éªŒè®¡åˆ’ | æ£€éªŒè®¡åˆ’å®šä¹‰ | plan_id, plan_name, item_id |
| `inspection_item` | æ£€éªŒé¡¹ç›® | æ£€éªŒé¡¹ç›®å®šä¹‰ | item_id, check_item, check_method |
| `inspection` | æ£€éªŒå• | è´¨é‡æ£€éªŒè®°å½• | inspection_id, wo_id, inspector_id |
| `inspection_detail` | æ£€éªŒæ˜ç»† | æ£€éªŒç»“æœæ˜ç»† | inspection_id, check_item, result |

### 1.6 åº“å­˜ç®¡ç†è¡¨ (5å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `stock` | åº“å­˜è¡¨ | åº“å­˜ä¿¡æ¯ | stock_id, item_id, location_id, qty |
| `stock_transaction` | åº“å­˜äº¤æ˜“ | åº“å­˜å‡ºå…¥åº“è®°å½• | transaction_id, item_id, transaction_type |
| `stock_reservation` | åº“å­˜é¢„ç•™ | åº“å­˜é¢„ç•™è®°å½• | reservation_id, item_id, reserved_qty |
| `stock_count` | ç›˜ç‚¹è¡¨ | åº“å­˜ç›˜ç‚¹ | count_id, count_date, status |
| `stock_count_detail` | ç›˜ç‚¹æ˜ç»† | ç›˜ç‚¹ç»“æœæ˜ç»† | count_id, item_id, counted_qty |

### 1.7 è¿½æº¯ç®¡ç†è¡¨ (3å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `dynamic_entity` | åŠ¨æ€å®ä½“ | åŠ¨æ€å®ä½“å®šä¹‰ | entity_id, entity_type, entity_name |
| `dynamic_attribute` | åŠ¨æ€å±æ€§ | åŠ¨æ€å±æ€§å®šä¹‰ | attr_id, entity_id, attr_name |
| `dynamic_attribute_value` | åŠ¨æ€å±æ€§å€¼ | åŠ¨æ€å±æ€§å€¼å­˜å‚¨ | entity_id, attr_id, attr_value |

### 1.8 ç³»ç»Ÿé…ç½®è¡¨ (6å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `sys_config` | ç³»ç»Ÿé…ç½® | ç³»ç»Ÿå‚æ•°é…ç½® | config_id, config_key, config_value |
| `sys_dict` | æ•°æ®å­—å…¸ | å­—å…¸æ•°æ® | dict_id, dict_type, dict_key |
| `sys_parameter` | ç³»ç»Ÿå‚æ•° | ç³»ç»Ÿè¿è¡Œå‚æ•° | param_id, param_key, param_value |
| `sys_notification` | ç³»ç»Ÿé€šçŸ¥ | é€šçŸ¥æ¶ˆæ¯ | notification_id, title, content |
| `sys_job` | ç³»ç»Ÿä»»åŠ¡ | å®šæ—¶ä»»åŠ¡ | job_id, job_name, cron_expression |
| `employee_skill` | å‘˜å·¥æŠ€èƒ½ | å‘˜å·¥æŠ€èƒ½å…³è” | employee_id, skill_id, level |

---

## ğŸ›’ btc_procurement æ•°æ®åº“ (9å¼ è¡¨)

### 2.1 é‡‡è´­ä¸šåŠ¡è¡¨ (7å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `purchase_order` | é‡‡è´­è®¢å• | é‡‡è´­è®¢å•ä¸»è¡¨ | po_id, po_no, supplier_id, status |
| `purchase_order_detail` | é‡‡è´­è®¢å•æ˜ç»† | é‡‡è´­è®¢å•æ˜ç»† | po_id, item_id, qty, unit_price |
| `purchase_receipt` | é‡‡è´­æ”¶è´§å• | é‡‡è´­æ”¶è´§è®°å½• | receipt_id, po_id, receipt_date |
| `purchase_receipt_detail` | é‡‡è´­æ”¶è´§æ˜ç»† | é‡‡è´­æ”¶è´§æ˜ç»† | receipt_id, item_id, received_qty |
| `supplier_evaluation` | ä¾›åº”å•†è¯„ä»· | ä¾›åº”å•†ç»©æ•ˆè¯„ä»· | eval_id, supplier_id, score |
| `purchase_contract` | é‡‡è´­åˆåŒ | é‡‡è´­åˆåŒç®¡ç† | contract_id, supplier_id, contract_no |
| `purchase_contract_detail` | é‡‡è´­åˆåŒæ˜ç»† | é‡‡è´­åˆåŒæ˜ç»† | contract_id, item_id, contract_qty |

### 2.2 BIèšåˆè¡¨ (1å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `agg_procurement_performance_1d` | é‡‡è´­ç»©æ•ˆèšåˆ | æ¯æ—¥é‡‡è´­ç»©æ•ˆç»Ÿè®¡ | agg_date, supplier_id, metrics |

### 2.3 æ•°æ®åŒæ­¥è¡¨ (1å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `core_data_sync` | æ ¸å¿ƒæ•°æ®åŒæ­¥ | ä¸æ ¸å¿ƒæ•°æ®åº“åŒæ­¥ | sync_id, sync_type, last_sync_time |

---

## ğŸ”§ btc_maintenance æ•°æ®åº“ (10å¼ è¡¨)

### 3.1 ç»´ä¿®ä¸šåŠ¡è¡¨ (8å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `maintenance_plan` | ç»´ä¿®è®¡åˆ’ | è®¾å¤‡ç»´ä¿®è®¡åˆ’ | plan_id, equipment_id, plan_type |
| `maintenance_work_order` | ç»´ä¿®å·¥å• | ç»´ä¿®å·¥å• | mwo_id, equipment_id, plan_id |
| `maintenance_work_order_detail` | ç»´ä¿®å·¥å•æ˜ç»† | ç»´ä¿®å·¥å•æ˜ç»† | mwo_id, task_id, status |
| `spare_part_usage` | å¤‡ä»¶ä½¿ç”¨ | å¤‡ä»¶ä½¿ç”¨è®°å½• | usage_id, mwo_id, part_id |
| `maintenance_checklist` | ç»´ä¿®æ£€æŸ¥æ¸…å• | ç»´ä¿®æ£€æŸ¥æ¸…å• | checklist_id, equipment_type |
| `maintenance_checklist_item` | æ£€æŸ¥æ¸…å•é¡¹ | æ£€æŸ¥æ¸…å•é¡¹ç›® | item_id, checklist_id, check_item |
| `maintenance_check_record` | æ£€æŸ¥è®°å½• | ç»´ä¿®æ£€æŸ¥è®°å½• | record_id, mwo_id, item_id |
| `failure_record` | æ•…éšœè®°å½• | è®¾å¤‡æ•…éšœè®°å½• | failure_id, equipment_id, failure_type |

### 3.2 BIèšåˆè¡¨ (2å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `agg_maintenance_performance_1d` | ç»´ä¿®ç»©æ•ˆèšåˆ | æ¯æ—¥ç»´ä¿®ç»©æ•ˆç»Ÿè®¡ | agg_date, equipment_id, metrics |
| `agg_equipment_reliability_1w` | è®¾å¤‡å¯é æ€§èšåˆ | æ¯å‘¨è®¾å¤‡å¯é æ€§ç»Ÿè®¡ | agg_week, equipment_id, reliability |

---

## ğŸ“ btc_log æ•°æ®åº“ (15å¼ è¡¨)

### 4.1 æ“ä½œæ—¥å¿—è¡¨ (8å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `sys_operation_log` | ç³»ç»Ÿæ“ä½œæ—¥å¿— | ç”¨æˆ·æ“ä½œè®°å½• | log_id, user_id, operation_type |
| `sys_login_log` | ç™»å½•æ—¥å¿— | ç”¨æˆ·ç™»å½•è®°å½• | log_id, user_id, login_time |
| `data_change_history` | æ•°æ®å˜æ›´å†å² | æ•°æ®å˜æ›´è®°å½• | history_id, table_name, record_id |
| `login_attempt_log` | ç™»å½•å°è¯•æ—¥å¿— | ç™»å½•å°è¯•è®°å½• | attempt_id, username, attempt_time |
| `business_operation_log` | ä¸šåŠ¡æ“ä½œæ—¥å¿— | ä¸šåŠ¡æ“ä½œè®°å½• | log_id, business_type, operation |
| `file_operation_log` | æ–‡ä»¶æ“ä½œæ—¥å¿— | æ–‡ä»¶æ“ä½œè®°å½• | log_id, file_name, operation_type |
| `data_export_log` | æ•°æ®å¯¼å‡ºæ—¥å¿— | æ•°æ®å¯¼å‡ºè®°å½• | export_id, user_id, export_type |
| `data_import_log` | æ•°æ®å¯¼å…¥æ—¥å¿— | æ•°æ®å¯¼å…¥è®°å½• | import_id, user_id, import_type |

### 4.2 ç³»ç»Ÿæ—¥å¿—è¡¨ (7å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `system_monitor_log` | ç³»ç»Ÿç›‘æ§æ—¥å¿— | ç³»ç»Ÿç›‘æ§è®°å½• | log_id, monitor_type, alert_level |
| `alert_log` | å‘Šè­¦æ—¥å¿— | ç³»ç»Ÿå‘Šè­¦è®°å½• | alert_id, alert_type, severity |
| `sys_job_log` | ç³»ç»Ÿä»»åŠ¡æ—¥å¿— | å®šæ—¶ä»»åŠ¡æ‰§è¡Œè®°å½• | job_log_id, job_id, execution_time |
| `api_call_log` | APIè°ƒç”¨æ—¥å¿— | APIè°ƒç”¨è®°å½• | log_id, api_path, response_time |
| `database_operation_log` | æ•°æ®åº“æ“ä½œæ—¥å¿— | æ•°æ®åº“æ“ä½œè®°å½• | log_id, operation_type, table_name |
| `cache_operation_log` | ç¼“å­˜æ“ä½œæ—¥å¿— | ç¼“å­˜æ“ä½œè®°å½• | log_id, cache_key, operation_type |
| `message_queue_log` | æ¶ˆæ¯é˜Ÿåˆ—æ—¥å¿— | æ¶ˆæ¯é˜Ÿåˆ—è®°å½• | log_id, queue_name, message_type |

---

## ğŸ“Š btc_bi æ•°æ®åº“ (47å¼ è¡¨)

### 5.1 ç”Ÿäº§åŸŸèšåˆè¡¨ (7å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `agg_production_progress_5m` | ç”Ÿäº§è¿›åº¦èšåˆ(5åˆ†é’Ÿ) | ç”Ÿäº§è¿›åº¦ç»Ÿè®¡ | bucket_start, wo_id, progress_rate |
| `agg_wip_status_5m` | WIPçŠ¶æ€èšåˆ(5åˆ†é’Ÿ) | åœ¨åˆ¶å“çŠ¶æ€ç»Ÿè®¡ | bucket_start, line_id, wip_qty |
| `agg_inventory_turnover_1h` | åº“å­˜å‘¨è½¬èšåˆ(1å°æ—¶) | åº“å­˜å‘¨è½¬ç»Ÿè®¡ | bucket_start, item_id, turnover_rate |
| `agg_stock_transaction_5m` | åº“å­˜äº¤æ˜“èšåˆ(5åˆ†é’Ÿ) | åº“å­˜äº¤æ˜“ç»Ÿè®¡ | bucket_start, item_id, transaction_qty |
| `agg_supplier_performance_1d` | ä¾›åº”å•†ç»©æ•ˆèšåˆ(1å¤©) | ä¾›åº”å•†ç»©æ•ˆç»Ÿè®¡ | agg_date, supplier_id, performance_score |
| `agg_cost_analysis_1d` | æˆæœ¬åˆ†æèšåˆ(1å¤©) | æˆæœ¬åˆ†æç»Ÿè®¡ | agg_date, item_id, total_cost |
| `agg_workorder_efficiency_1h` | å·¥å•æ•ˆç‡èšåˆ(1å°æ—¶) | å·¥å•æ•ˆç‡ç»Ÿè®¡ | bucket_start, wo_id, efficiency |

### 5.2 è´¨é‡åŸŸèšåˆè¡¨ (6å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `agg_quality_stats_5m` | è´¨é‡ç»Ÿè®¡èšåˆ(5åˆ†é’Ÿ) | è´¨é‡ç»Ÿè®¡ | bucket_start, inspection_id, pass_rate |
| `agg_defect_analysis_1h` | ç¼ºé™·åˆ†æèšåˆ(1å°æ—¶) | ç¼ºé™·åˆ†æç»Ÿè®¡ | bucket_start, defect_code, defect_count |
| `agg_inspector_performance_1d` | æ£€éªŒå‘˜ç»©æ•ˆèšåˆ(1å¤©) | æ£€éªŒå‘˜ç»©æ•ˆç»Ÿè®¡ | agg_date, inspector_id, performance |
| `agg_repair_stats_1h` | ç»´ä¿®ç»Ÿè®¡èšåˆ(1å°æ—¶) | ç»´ä¿®ç»Ÿè®¡ | bucket_start, equipment_id, repair_count |
| `agg_test_stats_1h` | æµ‹è¯•ç»Ÿè®¡èšåˆ(1å°æ—¶) | æµ‹è¯•ç»Ÿè®¡ | bucket_start, test_type, test_count |
| `agg_quality_cost_1d` | è´¨é‡æˆæœ¬èšåˆ(1å¤©) | è´¨é‡æˆæœ¬ç»Ÿè®¡ | agg_date, cost_type, total_cost |

### 5.3 è®¾å¤‡åŸŸèšåˆè¡¨ (7å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `agg_equipment_efficiency_5m` | è®¾å¤‡æ•ˆç‡èšåˆ(5åˆ†é’Ÿ) | è®¾å¤‡æ•ˆç‡ç»Ÿè®¡ | bucket_start, equipment_id, efficiency |
| `agg_equipment_failure_1h` | è®¾å¤‡æ•…éšœèšåˆ(1å°æ—¶) | è®¾å¤‡æ•…éšœç»Ÿè®¡ | bucket_start, equipment_id, failure_count |
| `agg_alert_stats_1h` | å‘Šè­¦ç»Ÿè®¡èšåˆ(1å°æ—¶) | å‘Šè­¦ç»Ÿè®¡ | bucket_start, alert_type, alert_count |
| `agg_sensor_data_5m` | ä¼ æ„Ÿå™¨æ•°æ®èšåˆ(5åˆ†é’Ÿ) | ä¼ æ„Ÿå™¨æ•°æ®ç»Ÿè®¡ | bucket_start, sensor_id, avg_value |
| `agg_user_activity_1h` | ç”¨æˆ·æ´»åŠ¨èšåˆ(1å°æ—¶) | ç”¨æˆ·æ´»åŠ¨ç»Ÿè®¡ | bucket_start, user_id, activity_count |
| `agg_system_performance_5m` | ç³»ç»Ÿæ€§èƒ½èšåˆ(5åˆ†é’Ÿ) | ç³»ç»Ÿæ€§èƒ½ç»Ÿè®¡ | bucket_start, metric_type, metric_value |
| `agg_equipment_reliability_1w` | è®¾å¤‡å¯é æ€§èšåˆ(1å‘¨) | è®¾å¤‡å¯é æ€§ç»Ÿè®¡ | agg_week, equipment_id, reliability |

### 5.4 å¼‚å¸¸é¢„è­¦ç›‘æ§è¡¨ (12å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `alert_rule_config` | é¢„è­¦è§„åˆ™é…ç½®è¡¨ | é¢„è­¦è§„åˆ™å®šä¹‰ | rule_id, rule_name, alert_type, severity_level |
| `alert_event` | é¢„è­¦äº‹ä»¶è®°å½•è¡¨ | é¢„è­¦äº‹ä»¶è¯¦æƒ… | event_id, rule_id, alert_type, severity_level |
| `alert_notification` | é¢„è­¦é€šçŸ¥è®°å½•è¡¨ | é€šçŸ¥å‘é€è®°å½• | notification_id, event_id, channel_type, status |
| `production_alert_monitor` | ç”Ÿäº§å¼‚å¸¸ç›‘æ§è¡¨ | ç”Ÿäº§å¼‚å¸¸ç›‘æ§ | monitor_id, wo_id, monitor_type, alert_level |
| `quality_alert_monitor` | è´¨é‡å¼‚å¸¸ç›‘æ§è¡¨ | è´¨é‡å¼‚å¸¸ç›‘æ§ | monitor_id, item_id, defect_rate, alert_level |
| `equipment_alert_monitor` | è®¾å¤‡å¼‚å¸¸ç›‘æ§è¡¨ | è®¾å¤‡å¼‚å¸¸ç›‘æ§ | monitor_id, equipment_id, oee, alert_level |
| `inventory_alert_monitor` | åº“å­˜å¼‚å¸¸ç›‘æ§è¡¨ | åº“å­˜å¼‚å¸¸ç›‘æ§ | monitor_id, item_id, current_stock, alert_level |
| `agg_alert_stats_1h` | é¢„è­¦ç»Ÿè®¡èšåˆè¡¨(1å°æ—¶) | é¢„è­¦ç»Ÿè®¡ | bucket_start, alert_type, total_alerts |
| `real_time_alert_dashboard` | å®æ—¶å‘Šè­¦ä»ªè¡¨æ¿ | å‘Šè­¦ä»ªè¡¨æ¿æ•°æ® | dashboard_id, alert_type, total_active_alerts |
| `alert_rule_execution_log` | é¢„è­¦è§„åˆ™æ‰§è¡Œæ—¥å¿— | è§„åˆ™æ‰§è¡Œè®°å½• | execution_id, rule_id, execution_status |

### 5.5 å®æ—¶æŒ‡æ ‡è¡¨ (3å¼ )

| è¡¨å | ä¸­æ–‡åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å­—æ®µ |
|------|----------|----------|----------|
| `real_time_metrics_cache` | å®æ—¶æŒ‡æ ‡ç¼“å­˜ | å®æ—¶æŒ‡æ ‡æ•°æ®ç¼“å­˜ | metric_id, metric_type, metric_value |
| `bi_data_quality_monitor` | BIæ•°æ®è´¨é‡ç›‘æ§ | æ•°æ®è´¨é‡ç›‘æ§ | monitor_id, table_name, quality_score |
| `bi_aggregation_task_log` | BIèšåˆä»»åŠ¡æ—¥å¿— | èšåˆä»»åŠ¡æ‰§è¡Œæ—¥å¿— | task_id, task_type, execution_time |

---

## ğŸ› ï¸ è¡¨ç®¡ç†æ“ä½œæŒ‡å—

### å¢åŠ æ–°è¡¨

1. **ç¡®å®šæ•°æ®åº“å½’å±**
   - æ ¸å¿ƒä¸šåŠ¡è¡¨ â†’ `btc_core`
   - é‡‡è´­ä¸šåŠ¡è¡¨ â†’ `btc_procurement`
   - ç»´ä¿®ä¸šåŠ¡è¡¨ â†’ `btc_maintenance`
   - æ—¥å¿—è¡¨ â†’ `btc_log`
   - BIèšåˆè¡¨ â†’ `btc_bi`

2. **åˆ›å»ºè¡¨ç»“æ„**
   ```sql
   -- åœ¨å¯¹åº”çš„schemaæ–‡ä»¶ä¸­æ·»åŠ CREATE TABLEè¯­å¥
   CREATE TABLE new_table (
       id VARCHAR(32) PRIMARY KEY,
       -- å…¶ä»–å­—æ®µ
       created_at DATETIME DEFAULT CURRENT_TIMESTAMP
   );
   ```

3. **æ›´æ–°è¿ç§»è„šæœ¬**
   ```sql
   -- åœ¨migrationsç›®å½•æ·»åŠ æ–°çš„è¿ç§»æ–‡ä»¶
   -- V20250107_XXXX__create_new_table.sql
   ```

4. **æ›´æ–°æ–‡æ¡£**
   - æ›´æ–°æœ¬æ¸…å•æ–‡æ¡£
   - æ›´æ–°å¯¹åº”çš„æ¶æ„æ–‡æ¡£

### åˆ é™¤è¡¨

1. **æ£€æŸ¥ä¾èµ–å…³ç³»**
   ```sql
   -- æ£€æŸ¥å¤–é”®ä¾èµ–
   SELECT * FROM information_schema.KEY_COLUMN_USAGE 
   WHERE REFERENCED_TABLE_NAME = 'table_name';
   ```

2. **å¤‡ä»½æ•°æ®**
   ```bash
   mysqldump -u username -p database_name table_name > backup.sql
   ```

3. **åˆ é™¤è¡¨**
   ```sql
   DROP TABLE IF EXISTS table_name;
   ```

4. **æ›´æ–°æ–‡æ¡£**
   - ä»æœ¬æ¸…å•ä¸­ç§»é™¤
   - æ›´æ–°ç›¸å…³æ¶æ„æ–‡æ¡£

### ä¿®æ”¹è¡¨ç»“æ„

1. **åˆ›å»ºALTERè¯­å¥**
   ```sql
   -- æ·»åŠ å­—æ®µ
   ALTER TABLE table_name ADD COLUMN new_field VARCHAR(100);
   
   -- ä¿®æ”¹å­—æ®µ
   ALTER TABLE table_name MODIFY COLUMN field_name VARCHAR(200);
   
   -- åˆ é™¤å­—æ®µ
   ALTER TABLE table_name DROP COLUMN field_name;
   ```

2. **åˆ›å»ºè¿ç§»è„šæœ¬**
   ```sql
   -- V20250107_XXXX__alter_table_name.sql
   ```

3. **æµ‹è¯•è¿ç§»**
   ```bash
   # åœ¨æµ‹è¯•ç¯å¢ƒæ‰§è¡Œè¿ç§»
   flyway migrate
   ```

---

## ğŸ“‹ è¡¨å‘½åè§„èŒƒ

### å‘½åçº¦å®š

1. **è¡¨åè§„èŒƒ**
   - ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿
   - ä¸šåŠ¡è¡¨ï¼š`ä¸šåŠ¡åŠŸèƒ½_ç±»å‹` (å¦‚: `purchase_order`)
   - èšåˆè¡¨ï¼š`agg_ä¸šåŠ¡åŸŸ_ç²’åº¦` (å¦‚: `agg_production_progress_5m`)
   - ç³»ç»Ÿè¡¨ï¼š`sys_åŠŸèƒ½` (å¦‚: `sys_user`)

2. **å­—æ®µå‘½å**
   - ä¸»é”®ï¼š`è¡¨å_id` (å¦‚: `user_id`)
   - å¤–é”®ï¼š`å…³è”è¡¨_id` (å¦‚: `tenant_id`)
   - çŠ¶æ€å­—æ®µï¼š`status`
   - æ—¶é—´å­—æ®µï¼š`created_at`, `updated_at`

3. **ç´¢å¼•å‘½å**
   - ä¸»é”®ç´¢å¼•ï¼š`PRIMARY`
   - å”¯ä¸€ç´¢å¼•ï¼š`uk_å­—æ®µå`
   - æ™®é€šç´¢å¼•ï¼š`idx_å­—æ®µå`
   - å¤åˆç´¢å¼•ï¼š`idx_å­—æ®µ1_å­—æ®µ2`

---

## ğŸ” è¡¨å…³ç³»å›¾

```mermaid
erDiagram
    tenant ||--o{ sys_dept : "has"
    tenant ||--o{ sys_user : "owns"
    sys_dept ||--o{ sys_user : "belongs_to"
    sys_dept ||--o{ sys_dept : "parent_child"
    
    sys_user ||--o{ sys_user_role : "has"
    sys_role ||--o{ sys_user_role : "assigned_to"
    sys_role ||--o{ sys_role_permission : "has"
    sys_role ||--o{ sys_role : "parent_child"
    sys_permission ||--o{ sys_role_permission : "granted_to"
    
    sys_menu ||--o{ sys_menu_permission : "has"
    sys_permission ||--o{ sys_menu_permission : "controls"
    
    item_master ||--o{ work_order : "produces"
    supplier_master ||--o{ item_master : "supplies"
    customer_master ||--o{ work_order : "orders"
    
    work_order ||--o{ wo_operation : "has"
    routing ||--o{ routing_operation : "contains"
    routing ||--o{ work_order : "uses"
    
    item_master ||--o{ bom_detail : "in_bom"
    bom_header ||--o{ bom_detail : "contains"
    
    work_order ||--o{ inspection : "requires"
    inspection ||--o{ inspection_detail : "has"
    
    item_master ||--o{ stock : "stored_as"
    stock ||--o{ stock_transaction : "transacted"
```

---

## ğŸ“ è”ç³»ä¿¡æ¯

å¦‚æœ‰è¡¨ç»“æ„ç›¸å…³é—®é¢˜ï¼Œè¯·è”ç³»ï¼š
- **æ•°æ®åº“æ¶æ„å¸ˆ**: db-arch@btc-mes.com
- **å¼€å‘å›¢é˜Ÿ**: dev@btc-mes.com
- **æŠ€æœ¯æ”¯æŒ**: support@btc-mes.com

---

*æœ€åæ›´æ–°æ—¶é—´: 2025-01-07*
*æ–‡æ¡£ç‰ˆæœ¬: v1.0.0*
