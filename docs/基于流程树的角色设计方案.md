# 基于MES系统全局架构流程树的角色设计方案

## 📋 概述

本方案基于MES系统全局架构基础文档中的流程树结构，结合三个租户（UK_HEAD、INERT、SUPPLIER）的实际需求，重新设计角色体系。角色设计遵循业务流程导向，确保每个角色都有明确的职责范围和权限边界。

---

## 🔄 流程树分析

### 1. 主流程结构
```
订单需求发起 → 资源准备 → 生产执行 → 物流仓储 → 品质与出货 → 数据追溯与分析 → 流程闭环归档
```

### 2. 关键子流程
- **IQC检验子流程**: 物料到货 → 创建检验单 → AQL抽样检测 → 入库/隔离处理
- **生产+IPQC子流程**: 工单下发 → 备料交付 → 装配组装 → 首件验证 → 批量生产 → IPQC巡检
- **OQC与出货子流程**: 成品打包 → 生成箱号 → OQC抽检 → 出货放行
- **盘点与审计子流程**: 盘点任务 → 移动端扫描 → 数据对比 → 差异处理
- **客诉追溯子流程**: 接收客诉 → 反查批次 → 关联分析 → 责任归因

### 3. BI实时监控流程
- 数据采集 → 增量聚合 → 缓存推送 → 大屏展示 → 质量监控告警

---

## 🎭 角色设计原则

### 1. 流程导向原则
- 角色设计基于业务流程节点
- 每个角色对应特定的流程职责
- 支持跨部门协作和流程衔接

### 2. 租户隔离原则
- 不同租户的角色体系相对独立
- 支持租户特定的业务需求
- 保持数据安全和权限隔离

### 3. 职责明确原则
- 每个角色都有明确的职责边界
- 避免角色职责重叠和冲突
- 支持角色继承和权限传递

### 4. 扩展性原则
- 支持新业务流程的角色扩展
- 支持角色权限的动态调整
- 支持跨租户角色模板复用

---

## 🏢 租户角色体系设计

## 1. UK_HEAD (英国总公司) 角色体系

### 1.1 战略决策层
```
ROLE_UK_EXECUTIVE (英国执行层)
├── 职责: 战略决策、投资决策、重大事项审批
├── 流程权限: 全流程查看、关键节点审批
├── 数据权限: 全公司数据、财务数据、绩效数据
└── 继承: 无父角色

ROLE_UK_DIRECTOR (英国总监层)
├── 职责: 部门管理、绩效监控、资源配置
├── 流程权限: 部门相关流程管理、异常处理审批
├── 数据权限: 部门数据、跨部门协作数据
└── 继承: ROLE_UK_EXECUTIVE
```

### 1.2 运营管理层
```
ROLE_UK_OPERATIONS_MANAGER (英国运营经理)
├── 职责: 日常运营监控、流程优化、KPI管理
├── 流程权限: 生产流程监控、质量流程监控、物流流程监控
├── 数据权限: 运营数据、绩效数据、分析报表
└── 继承: ROLE_UK_DIRECTOR

ROLE_UK_BI_ANALYST (英国BI分析师)
├── 职责: 数据分析、报表制作、趋势分析、异常预警
├── 流程权限: BI数据采集、报表生成、告警配置
├── 数据权限: 全流程数据、历史数据、对比数据
└── 继承: ROLE_UK_OPERATIONS_MANAGER
```

### 1.3 技术支持层
```
ROLE_UK_IT_ADMIN (英国IT管理员)
├── 职责: 系统管理、用户管理、数据备份、安全维护
├── 流程权限: 系统配置、用户权限管理、数据管理
├── 数据权限: 系统数据、用户数据、配置数据
└── 继承: ROLE_UK_OPERATIONS_MANAGER

ROLE_UK_VIEWER (英国查看者)
├── 职责: 数据查看、报表查看、趋势监控
├── 流程权限: 只读访问所有流程数据
├── 数据权限: 只读访问所有业务数据
└── 继承: ROLE_UK_BI_ANALYST
```

## 2. INERT (内网用户) 角色体系

### 2.1 生产管理层
```
ROLE_INERT_PRODUCTION_MANAGER (生产经理)
├── 职责: 生产计划、工单管理、资源配置、进度监控
├── 流程权限: 工单下发、生产执行、首件验证、批量生产
├── 数据权限: 生产数据、计划数据、资源数据
└── 继承: 无父角色

ROLE_INERT_PLANNING_ENGINEER (计划工程师)
├── 职责: 生产计划制定、工艺路线设计、BOM管理
├── 流程权限: 生产计划、工艺路线、BOM配置
├── 数据权限: 计划数据、工艺数据、BOM数据
└── 继承: ROLE_INERT_PRODUCTION_MANAGER

ROLE_INERT_WORK_ORDER_CONTROLLER (工单控制员)
├── 职责: 工单下发、进度跟踪、异常处理
├── 流程权限: 工单管理、进度更新、异常上报
├── 数据权限: 工单数据、进度数据、异常数据
└── 继承: ROLE_INERT_PLANNING_ENGINEER
```

### 2.2 质量管理层
```
ROLE_INERT_QUALITY_MANAGER (质量经理)
├── 职责: 质量体系管理、检验标准制定、质量问题处理
├── 流程权限: IQC检验、IPQC巡检、OQC出货、NCR处理
├── 数据权限: 质量数据、检验数据、缺陷数据
└── 继承: 无父角色

ROLE_INERT_IQC_INSPECTOR (IQC检验员)
├── 职责: 进料检验、AQL抽样、不合格处理
├── 流程权限: IQC检验单、AQL抽样、检验结果录入
├── 数据权限: 进料数据、检验数据、供应商数据
└── 继承: ROLE_INERT_QUALITY_MANAGER

ROLE_INERT_IPQC_INSPECTOR (IPQC巡检员)
├── 职责: 过程检验、抽检执行、质量问题发现
├── 流程权限: IPQC巡检、抽检记录、问题上报
├── 数据权限: 生产过程数据、检验数据、设备数据
└── 继承: ROLE_INERT_QUALITY_MANAGER

ROLE_INERT_OQC_INSPECTOR (OQC检验员)
├── 职责: 出货检验、AQL抽检、出货放行
├── 流程权限: OQC检验、出货放行、检验报告
├── 数据权限: 成品数据、出货数据、客户数据
└── 继承: ROLE_INERT_QUALITY_MANAGER
```

### 2.3 仓储物流层
```
ROLE_INERT_WAREHOUSE_MANAGER (仓库经理)
├── 职责: 库存管理、出入库管理、盘点管理、物流协调
├── 流程权限: 入库管理、出库管理、盘点执行、库存调整
├── 数据权限: 库存数据、出入库数据、盘点数据
└── 继承: 无父角色

ROLE_INERT_MATERIAL_HANDLER (物料管理员)
├── 职责: 物料收发、库存维护、备料管理
├── 流程权限: 物料收发、库存更新、备料执行
├── 数据权限: 物料数据、库存数据、收发数据
└── 继承: ROLE_INERT_WAREHOUSE_MANAGER

ROLE_INERT_INVENTORY_CONTROLLER (盘点员)
├── 职责: 定期盘点、差异分析、库存调整
├── 流程权限: 盘点任务、差异处理、库存调整
├── 数据权限: 盘点数据、差异数据、调整数据
└── 继承: ROLE_INERT_WAREHOUSE_MANAGER
```

### 2.4 生产执行层
```
ROLE_INERT_PRODUCTION_OPERATOR (生产操作员)
├── 职责: 装配组装、设备操作、首件制作、批量生产
├── 流程权限: 生产执行、首件验证、批量生产、数据录入
├── 数据权限: 生产数据、设备数据、质量数据
└── 继承: ROLE_INERT_PRODUCTION_MANAGER

ROLE_INERT_FAI_OPERATOR (首件验证员)
├── 职责: 首件制作、首件检验、工艺验证
├── 流程权限: 首件制作、首件检验、工艺调整
├── 数据权限: 首件数据、工艺数据、检验数据
└── 继承: ROLE_INERT_PRODUCTION_OPERATOR

ROLE_INERT_TEST_OPERATOR (测试操作员)
├── 职责: 产品测试、测试记录、故障处理
├── 流程权限: 测试执行、测试记录、故障上报
├── 数据权限: 测试数据、故障数据、设备数据
└── 继承: ROLE_INERT_PRODUCTION_OPERATOR
```

### 2.5 维护支持层
```
ROLE_INERT_MAINTENANCE_MANAGER (维护经理)
├── 职责: 设备维护、预防性维护、故障处理、备件管理
├── 流程权限: 维护计划、故障处理、备件管理、维护记录
├── 数据权限: 设备数据、维护数据、故障数据、备件数据
└── 继承: 无父角色

ROLE_INERT_MAINTENANCE_TECHNICIAN (维护技师)
├── 职责: 设备维护、故障维修、日常保养
├── 流程权限: 维护执行、故障处理、维护记录
├── 数据权限: 设备数据、维护数据、故障数据
└── 继承: ROLE_INERT_MAINTENANCE_MANAGER
```

### 2.6 追溯分析层
```
ROLE_INERT_TRACE_ANALYST (追溯分析师)
├── 职责: 客诉处理、追溯分析、责任归因、报告生成
├── 流程权限: 客诉接收、追溯查询、分析报告、责任认定
├── 数据权限: 追溯数据、客诉数据、历史数据、分析数据
└── 继承: ROLE_INERT_QUALITY_MANAGER
```

## 3. SUPPLIER (供应商群体) 角色体系

### 3.1 模具供应商
```
ROLE_SUPPLIER_MOLD_MANAGER (模具供应商经理)
├── 职责: 模具管理、状态更新、发货协同、质量反馈
├── 流程权限: 模具状态管理、发货信息更新、质量反馈
├── 数据权限: 模具数据、发货数据、质量数据
└── 继承: 无父角色

ROLE_SUPPLIER_MOLD_OPERATOR (模具操作员)
├── 职责: 模具状态维护、发货信息录入、问题反馈
├── 流程权限: 模具状态更新、发货信息录入
├── 数据权限: 模具数据、发货数据
└── 继承: ROLE_SUPPLIER_MOLD_MANAGER
```

### 3.2 原材料供应商
```
ROLE_SUPPLIER_RAW_MANAGER (原材料供应商经理)
├── 职责: 原材料供应、质量保证、IQC协同、供应商评分
├── 流程权限: 供应信息管理、质量反馈、IQC协同
├── 数据权限: 供应数据、质量数据、IQC数据
└── 继承: 无父角色

ROLE_SUPPLIER_RAW_OPERATOR (原材料操作员)
├── 职责: 供应信息维护、质量反馈、问题处理
├── 流程权限: 供应信息更新、质量反馈录入
├── 数据权限: 供应数据、质量数据
└── 继承: ROLE_SUPPLIER_RAW_MANAGER
```

---

## 🔄 流程权限映射

### 1. 主流程权限映射

| 流程节点 | UK_HEAD角色 | INERT角色 | SUPPLIER角色 |
|---------|-------------|-----------|--------------|
| 订单需求发起 | ROLE_UK_EXECUTIVE | ROLE_INERT_PRODUCTION_MANAGER | - |
| 资源准备 | ROLE_UK_OPERATIONS_MANAGER | ROLE_INERT_WAREHOUSE_MANAGER | ROLE_SUPPLIER_RAW_MANAGER |
| 生产执行 | ROLE_UK_BI_ANALYST | ROLE_INERT_PRODUCTION_OPERATOR | - |
| 物流仓储 | ROLE_UK_OPERATIONS_MANAGER | ROLE_INERT_MATERIAL_HANDLER | - |
| 品质与出货 | ROLE_UK_BI_ANALYST | ROLE_INERT_OQC_INSPECTOR | - |
| 数据追溯与分析 | ROLE_UK_BI_ANALYST | ROLE_INERT_TRACE_ANALYST | - |

### 2. 子流程权限映射

#### IQC检验子流程
| 流程节点 | 主要角色 | 辅助角色 |
|---------|----------|----------|
| 物料到货/建GRN | ROLE_INERT_MATERIAL_HANDLER | ROLE_SUPPLIER_RAW_OPERATOR |
| 创建IQC检验单 | ROLE_INERT_IQC_INSPECTOR | - |
| AQL抽样与检测 | ROLE_INERT_IQC_INSPECTOR | - |
| 入库登记 | ROLE_INERT_MATERIAL_HANDLER | - |
| 不合格处理 | ROLE_INERT_QUALITY_MANAGER | ROLE_SUPPLIER_RAW_MANAGER |
| 供应商评分 | ROLE_INERT_QUALITY_MANAGER | ROLE_SUPPLIER_RAW_MANAGER |

#### 生产+IPQC子流程
| 流程节点 | 主要角色 | 辅助角色 |
|---------|----------|----------|
| 工单下发 | ROLE_INERT_WORK_ORDER_CONTROLLER | - |
| 备料交付生产 | ROLE_INERT_MATERIAL_HANDLER | - |
| 装配/组装 | ROLE_INERT_PRODUCTION_OPERATOR | - |
| 首件验证(FAI) | ROLE_INERT_FAI_OPERATOR | ROLE_INERT_QUALITY_MANAGER |
| 批量生产 | ROLE_INERT_PRODUCTION_OPERATOR | - |
| IPQC巡检 | ROLE_INERT_IPQC_INSPECTOR | - |
| 初测/终测 | ROLE_INERT_TEST_OPERATOR | - |

#### OQC与出货子流程
| 流程节点 | 主要角色 | 辅助角色 |
|---------|----------|----------|
| 成品打包 | ROLE_INERT_PRODUCTION_OPERATOR | - |
| 生成箱号/托盘号 | ROLE_INERT_WAREHOUSE_MANAGER | - |
| OQC抽检 | ROLE_INERT_OQC_INSPECTOR | - |
| 出货放行 | ROLE_INERT_OQC_INSPECTOR | ROLE_INERT_WAREHOUSE_MANAGER |
| 出货报告归档 | ROLE_INERT_WAREHOUSE_MANAGER | - |

#### 盘点与审计子流程
| 流程节点 | 主要角色 | 辅助角色 |
|---------|----------|----------|
| 生成盘点任务 | ROLE_INERT_WAREHOUSE_MANAGER | - |
| 移动端扫描盘点 | ROLE_INERT_INVENTORY_CONTROLLER | - |
| 数据上传/缓存 | ROLE_INERT_INVENTORY_CONTROLLER | - |
| 对比ERP库存 | ROLE_INERT_WAREHOUSE_MANAGER | - |
| 差异处理 | ROLE_INERT_WAREHOUSE_MANAGER | ROLE_INERT_MATERIAL_HANDLER |

#### 客诉追溯子流程
| 流程节点 | 主要角色 | 辅助角色 |
|---------|----------|----------|
| 接收客户SN/箱号 | ROLE_INERT_TRACE_ANALYST | - |
| 反查批次/工单 | ROLE_INERT_TRACE_ANALYST | - |
| 关联用料批次/供应商 | ROLE_INERT_TRACE_ANALYST | ROLE_SUPPLIER_RAW_MANAGER |
| 查询IQC/OQC结果 | ROLE_INERT_TRACE_ANALYST | - |
| 提取测试/维修记录 | ROLE_INERT_TRACE_ANALYST | ROLE_INERT_MAINTENANCE_MANAGER |
| 生成责任归因报告 | ROLE_INERT_TRACE_ANALYST | ROLE_UK_EXECUTIVE |

---

## 🎯 角色权限设计

### 1. 数据权限级别
- **ALL**: 所有数据访问权限
- **TENANT**: 租户内所有数据
- **DEPT_AND_CHILD**: 本部门及子部门数据
- **DEPT**: 本部门数据
- **PROCESS**: 相关流程数据
- **SELF**: 个人数据

### 2. 操作权限级别
- **ADMIN**: 管理权限
- **WRITE**: 写入权限
- **READ**: 只读权限
- **APPROVE**: 审批权限
- **EXECUTE**: 执行权限

### 3. 流程权限级别
- **FULL**: 完整流程权限
- **PARTIAL**: 部分流程权限
- **VIEW**: 流程查看权限
- **MONITOR**: 流程监控权限

---

## 🔧 实现建议

### 1. 角色继承机制
- 支持多级角色继承
- 权限和数据范围继承
- 支持权限覆盖和例外

### 2. 动态权限控制
- 基于流程状态的权限控制
- 基于数据的权限过滤
- 支持临时权限授予

### 3. 跨租户协作
- 支持跨租户角色协作
- 共享流程权限管理
- 数据隔离和权限控制

### 4. 角色模板化
- 支持角色模板创建
- 快速部署新租户角色
- 角色配置标准化

---

## 📊 角色统计

### 1. 角色数量统计
- **UK_HEAD**: 7个角色
- **INERT**: 20个角色
- **SUPPLIER**: 4个角色
- **总计**: 31个角色

### 2. 角色层级统计
- **管理层**: 12个角色
- **执行层**: 15个角色
- **支持层**: 4个角色

### 3. 流程覆盖统计
- **主流程**: 100%覆盖
- **子流程**: 100%覆盖
- **跨流程**: 支持追溯和分析

这个基于流程树的角色设计方案确保了每个业务流程节点都有对应的角色负责，同时保持了租户隔离和权限控制的完整性。
